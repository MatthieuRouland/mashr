---
title: "Development vignette"
author: "Matthew Stephens"
date: "March 16, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Goal

This vignette is being used to test the new mash development and document features as they are added.

# Simple simulation

Just set up data and run basic mash
```{r}
  library("mashr2")
  set.seed(1)
  data = simple_sims(1000,5,1)
  
  
  m=mash_init(data$Bhat,data$Shat)
  mash_add_grid(m)
  
 # m = mash(data$Bhat,data$Shat) # this runs mash with just canonical covariance matrices
  mash_status(m)
```
  
  
Run 1-by-1 to add the strong signals
```{r}
  mash_run_1by1(m)
  mash_status(m)
  
  mash_add_strong_signals(m)
  
  mash_add_cov_ed(m) # adds covariance matrices based on extreme deconvolution, initialized from pca

  mash_fit_g(m)
  mash_compute_loglik(m) 
```

```{r}
  mash_add_cov(m) #this adds canonical covariance matrices
  mash_fit_g(m)
  mash_compute_loglik(m) 
```


The log likelihood gets better after adding the canonical matrices because the simulations used the canonical covariances. So that is good.
On the other hand the simple data-driven covariances did not do *too*
bad so that is also good.


Thoughts:

- add ability to prune low-weight components?
- test ed 
- maybe want to separate datadriven and canonical matrices?
-   could do runs that are separate and test how things improve with data-driven matrices?
- could store results from more than one mash run?
- how to copy a whole mash environment?



