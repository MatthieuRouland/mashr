---
title: "refactor vignette"
author: "Matthew Stephens"
date: "May 27, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Goal

This vignette is being used to test refactoring as it is done.

```{r}
  library("mashr2")
  set.seed(1)
  simdata = simple_sims(1000,5,1)
  data = set_mash_data(simdata$Bhat, simdata$Shat)
```

```{r}
  Ulist = cov_canonical(data)
  m2 = mash_new(data, Ulist)
  m = mash(data$Bhat,data$Shat,prior="uniform")
  
  identical(m$posterior_matrices[["mash"]], m2$posterior_matrices)
  identical(mash_compute_loglik(m),m2$loglik)
```

  
Check the 1by1 results are the same
```{r}
  m.1by1 = mash_run_1by1_new(data)
  mash_run_1by1(m)
  identical(m$posterior_matrices[["ash"]], m.1by1$posterior_matrices)
```

TODO:
- make covariance matrices so canoncical ones take R instead of data
- make posterior matrices include lfsr


Thoughts:

- add ability to prune low-weight components?
- test ed 
- maybe want to separate datadriven and canonical matrices?
-   could do runs that are separate and test how things improve with data-driven matrices?
- could store results from more than one mash run?
- how to copy a whole mash environment?

