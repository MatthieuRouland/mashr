---
title: "Refactor vignette 2"
author: "Matthew Stephens"
date: "May 27, 2017"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Goal

This vignette is a second one to test refactoring as it is done.

Here we run mash 3 times: with the canonical matrices only, with the data-driven only, and with both.

We see that the canonical matrices do best, and the data-driven add nothing.
This is expected as the data were simulated under the canonical matrices.
```{r}
  library("mashr2")
  set.seed(1)
  simdata = simple_sims(1000,5,1)
  data = set_mash_data(simdata$Bhat,simdata$Shat)
  m.1by1 = mash_run_1by1_new(data)
  top_1by1_hits = get_significant_results(m.1by1)
  U1 = cov_canonical(data)
  U2 = cov_data_driven(data,top_1by1_hits)
  m1 = mash_new(data, U1)
  m2 = mash_new(data, U2)
  m3 = mash_new(data, c(U1,U2))
  
  m1$loglik
  m2$loglik
  m3$loglik
```
