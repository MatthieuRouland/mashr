<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sample from mash posteriors • mashr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Sample from mash posteriors">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">mashr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/stephenslab/mashr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Sample from mash posteriors</h1>
                        <h4 class="author">Yuxin Zou</h4>
            
            <h4 class="date">2019-05-06</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Besides the point estimates from the posteriors of <code>mashr</code>, we also provide the option to sampling from the posteriors. Using the samples, we can answer many questions. For example, what proportion of effects have the same sign and similar magnitude for each pair of conditions?</p>
<p>We use simulated data for illustration. The simulation routine creates a dataset with 5 conditions, and four different types of effect: null, independent among conditions, condition-specific in condition 1, and shared (equal effects in all conditions). It creates 500 effects of each type for a total of 2000 effects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mashr)</code></pre></div>
<pre><code># Loading required package: ashr</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
simdata =<span class="st"> </span><span class="kw"><a href="../reference/simple_sims.html">simple_sims</a></span>(<span class="dv">500</span>,<span class="dv">5</span>,<span class="dv">1</span>)</code></pre></div>
</div>
<div id="fit-mash-model-with-samples-from-the-posteriors" class="section level1">
<h1 class="hasAnchor">
<a href="#fit-mash-model-with-samples-from-the-posteriors" class="anchor"></a>Fit mash model with samples from the posteriors</h1>
<p>Read in the data and set up the covariance matrices:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data =<span class="st"> </span><span class="kw"><a href="../reference/mash_set_data.html">mash_set_data</a></span>(simdata<span class="op">$</span>Bhat, simdata<span class="op">$</span>Shat)
U.c =<span class="st"> </span><span class="kw"><a href="../reference/cov_canonical.html">cov_canonical</a></span>(data)</code></pre></div>
<p>Here, we draw 100 samples from the posteriors of each effect.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m =<span class="st"> </span><span class="kw"><a href="../reference/mash.html">mash</a></span>(data, U.c, <span class="dt">algorithm.version =</span> <span class="st">'R'</span>, <span class="dt">posterior_samples =</span> <span class="dv">100</span>)</code></pre></div>
<pre><code>#  - Computing 2000 x 151 likelihood matrix.
#  - Likelihood calculations took 0.29 seconds.
#  - Fitting model with 151 mixture components.
#  - Model fitting took 157.86 seconds.
#  - Computing posterior matrices.
#  - Computation allocated took 28.70 seconds.</code></pre>
<p>Using <code><a href="../reference/get_samples.html">get_samples(m)</a></code>, we have a <span class="math inline">\(2000 \times 5 \times 100\)</span> array for samples.</p>
<p>If we fit the mash model without the posterior samples, we could use <code>mash_compute_posterior_matrices</code> to sample from the mash object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m<span class="op">$</span>result =<span class="st"> </span><span class="kw"><a href="../reference/mash_compute_posterior_matrices.html">mash_compute_posterior_matrices</a></span>(m, data, <span class="dt">algorithm.version =</span> <span class="st">'R'</span>,
                                           <span class="dt">posterior_samples =</span> <span class="dv">100</span>)</code></pre></div>
</div>
<div id="pairwise-sharing" class="section level1">
<h1 class="hasAnchor">
<a href="#pairwise-sharing" class="anchor"></a>Pairwise sharing</h1>
<p>To answer ‘what proportion of effects have the same sign and similar magnitude for each pair of conditions?’, <code>mash</code> has a function to summarize the results from samples. Here, we define similar in magnitude to mean both the same sign and within a factor of 2 of one another.</p>
<p><span class="math display">\[
\begin{align*}
&amp;\text{Proportion of effects have the same sign and similar magnitude for condition r, r'} \\
&amp;= \frac{1}{2000} \sum_{j=1}^{2000}\mathbb{E}\left(\mathbb{I}(b_{jr}, b_{jr'} \text{ have same sign and similar magnitude})  \right) \\
&amp;\approx \frac{1}{2000} \sum_{j=1}^{2000} \frac{1}{100} \sum_{m=1}^{100} \mathbb{I}(b_{jr}^{(m)}, b_{jr'}^{(m)} \text{ have same sign and similar magnitude})
\end{align*}
\]</span> The last approximation is achieved by sampling.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(corrplot)</code></pre></div>
<pre><code># corrplot 0.84 loaded</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw"><a href="../reference/get_pairwise_sharing_from_samples.html">get_pairwise_sharing_from_samples</a></span>(m, <span class="dt">factor=</span><span class="fl">0.5</span>, <span class="dt">lfsr_thresh =</span> <span class="dv">1</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/corrplot/topics/corrplot">corrplot</a></span>(x, <span class="dt">method=</span><span class="st">'color'</span>, <span class="dt">cl.lim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">type=</span><span class="st">'upper'</span>, <span class="dt">addCoef.col =</span> <span class="st">"black"</span>, <span class="dt">tl.col=</span><span class="st">"black"</span>, <span class="dt">tl.srt=</span><span class="dv">45</span>, <span class="dt">title =</span> <span class="st">'Pairwise Sharing by Magnitude'</span>, <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>))</code></pre></div>
<p><img src="mash_sampling_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We can also get the proportion of <strong>significant</strong> effects have the same sign and similar magnitude for each pair of conditions. For each pair of conditions, first identify the effects that are significant in at least one of the two conditions. Then compute the probability of sharing in sign and magnitude.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw"><a href="../reference/get_pairwise_sharing_from_samples.html">get_pairwise_sharing_from_samples</a></span>(m, <span class="dt">factor=</span><span class="fl">0.5</span>, <span class="dt">lfsr_thresh =</span> <span class="fl">0.05</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/corrplot/topics/corrplot">corrplot</a></span>(x, <span class="dt">method=</span><span class="st">'color'</span>, <span class="dt">cl.lim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">type=</span><span class="st">'upper'</span>, <span class="dt">addCoef.col =</span> <span class="st">"black"</span>, <span class="dt">tl.col=</span><span class="st">"black"</span>, <span class="dt">tl.srt=</span><span class="dv">45</span>, <span class="dt">title =</span> <span class="st">'Pairwise Sharing by Magnitude'</span>, <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>))</code></pre></div>
<p><img src="mash_sampling_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The pairwise sharing proportions are higher, since it is computed out of <strong>significant signals</strong> only.</p>
<p>There is another function in <code>mashr</code> package (<code>get_pairwise_sharing</code>) that compute the proportion of <strong>significant signals</strong> shared by magnitude in the <strong>estimated effect sizes</strong>, for each pair of conditions. For each pair of conditions, first identify the effects that are significant in at least one of the two conditions. Then compute what fraction of these have an estimated (posterior mean) effect size within a factor <code>factor</code> of one another.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw"><a href="../reference/get_pairwise_sharing.html">get_pairwise_sharing</a></span>(m, <span class="dt">factor=</span><span class="fl">0.5</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/corrplot/topics/corrplot">corrplot</a></span>(x, <span class="dt">method=</span><span class="st">'color'</span>, <span class="dt">cl.lim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">type=</span><span class="st">'upper'</span>, <span class="dt">addCoef.col =</span> <span class="st">"black"</span>, <span class="dt">tl.col=</span><span class="st">"black"</span>, <span class="dt">tl.srt=</span><span class="dv">45</span>, <span class="dt">title =</span> <span class="st">'Pairwise Sharing by Magnitude'</span>, <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">0</span>))</code></pre></div>
<p><img src="mash_sampling_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#fit-mash-model-with-samples-from-the-posteriors">Fit mash model with samples from the posteriors</a></li>
      <li><a href="#pairwise-sharing">Pairwise sharing</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matthew Stephens, Sarah Urbut, Gao Wang, Yuxin Zou, Peter Carbonetto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
